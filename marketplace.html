<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trick - Property Marketplace</title>
    <!-- Add favicon -->
    <link rel="icon" type="image/png" href="/images/logo.png">
    <link rel="shortcut icon" type="image/png" href="/images/logo.png">
    <!-- Base styles first -->
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/layout.css">
    <!-- Components next -->
    <link rel="stylesheet" href="css/components/navigation.css">
    <link rel="stylesheet" href="css/components/hero.css">
    <link rel="stylesheet" href="css/components/footer.css">
    <link rel="stylesheet" href="css/components/cards.css">
    <link rel="stylesheet" href="css/components/forms.css">
    <link rel="stylesheet" href="css/components/chat.css">
    <!-- Add marketplace styles with correct path -->
    <link rel="stylesheet" href="css/sections/marketplace.css" type="text/css">
    <link rel="stylesheet" href="css/components/property-lookup.css">
    <link rel="stylesheet" href="css/components/property-dashboard.css">
    <!-- Add variables -->
    <style>
        :root {
            --primary: #000000;
            --secondary: #1DB954;
            --text: #FFFFFF;
            --text-secondary: rgba(255, 255, 255, 0.7);
            --dark-gray: #121212;
            --medium-gray: #1E1E1E;
            --light-gray: #404040;
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="js/common.js"></script>
</head>
<body>
    <nav class="nav">
        <div class="container nav-container">
            <a href="/" class="nav-brand">
                <img src="/images/logo.png" alt="Trick Logo" class="logo">
                <span class="nav-logo">Trick</span>
            </a>
            <div class="nav-links">
                <div class="nav-item">
                    <a href="#about" class="nav-link">About</a>
                    <div class="nav-dropdown">
                        <a href="/#problem" class="scroll-link">The Problem</a>

                        <a href="/#benefits" class="scroll-link">Benefits</a>
                    </div>
                </div>
                <div class="nav-item">
                    <a href="#tokenization" class="nav-link">How It Works</a>
                    <div class="nav-dropdown">
                        <a href="/#tokenization" class="scroll-link">Tokenization</a>

                    </div>
                </div>
                <div class="nav-item">
                    <a href="/marketplace.html" class="nav-link">Properties</a>
                    <div class="nav-dropdown">
                        <a href="/marketplace.html">Browse Properties</a>
                        <a href="#" onclick="showPropertyLookup(event)">Property Lookup</a>
                    </div>
                </div>
                <a href="/wallet.html" class="nav-page">Wallet</a>
                <a href="/#contact" class="nav-page contact-btn">Contact Us</a>
            </div>
        </div>
    </nav>

    <section class="transactions">
        <div class="container">
            <h2 class="marketplace-title">Property Marketplace</h2>
            
            <!-- Marketplace View -->
            <div class="view-content marketplace-view" id="marketplace-view">
                <div class="search-container">
                    <div class="search-bar">
                        <input type="text" id="propertySearch" placeholder="Search by location (e.g. Kuala Lumpur), type, or price range...">
                        <button class="search-btn">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="11" cy="11" r="8"/>
                                <line x1="21" y1="21" x2="16.65" y2="16.65"/>
                            </svg>
                        </button>
                    </div>
                    <div class="filter-options">
                        <select id="propertyType">
                            <option value="">Property Type</option>
                            <option value="residential">Residential</option>
                            <option value="commercial">Commercial</option>
                            <option value="industrial">Industrial</option>
                        </select>
                        <select id="priceRange">
                            <option value="">Price Range</option>
                            <option value="800000-2000000">RM800k - RM2M</option>
                            <option value="2000000-3500000">RM2M - RM3.5M</option>
                            <option value="3500000-5000000">RM3.5M - RM5M</option>
                            <option value="5000000-7000000">RM5M - RM7M</option>
                            <option value="7000000-9000000">RM7M - RM9M</option>
                        </select>
                        <select id="tokenization">
                            <option value="">Tokenization Status</option>
                            <option value="available">Available for Tokenization</option>
                            <option value="in-progress">Tokenization in Progress</option>
                            <option value="completed">Fully Tokenized</option>
                        </select>
                    </div>
                </div>

                <div class="property-grid">
                    <!-- First 6 property cards -->
                    <div class="property-card"><!-- Property 1 --></div>
                    <div class="property-card"><!-- Property 2 --></div>
                    <div class="property-card"><!-- Property 3 --></div>
                    <div class="property-card"><!-- Property 4 --></div>
                    <div class="property-card"><!-- Property 5 --></div>
                    <div class="property-card"><!-- Property 6 --></div>
                </div>

                <div class="pagination">
                    <button class="page-btn" data-page="1">1</button>
                    <button class="page-btn" data-page="2">2</button>
                    <button class="page-btn" data-page="3">3</button>
                    <button class="page-btn next-page">Next</button>
                </div>
            </div>

            <!-- Property Lookup View -->
            <div class="view-content lookup-view" id="lookup-view" style="display: none;">
                <div class="lookup-form">
                    <div class="form-group">
                        <label for="address">Property Address</label>
                        <input type="text" id="address" required>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="city">City</label>
                            <input type="text" id="city" required>
                        </div>
                        <div class="form-group">
                            <label for="state">State</label>
                            <select id="state" required>
                                <option value="">Select State</option>
                                <option value="Johor">Johor</option>
                                <option value="Kedah">Kedah</option>
                                <option value="Kelantan">Kelantan</option>
                                <option value="Melaka">Melaka</option>
                                <option value="Negeri Sembilan">Negeri Sembilan</option>
                                <option value="Pahang">Pahang</option>
                                <option value="Penang">Penang</option>
                                <option value="Perak">Perak</option>
                                <option value="Perlis">Perlis</option>
                                <option value="Sabah">Sabah</option>
                                <option value="Sarawak">Sarawak</option>
                                <option value="Selangor">Selangor</option>
                                <option value="Terengganu">Terengganu</option>
                                <option value="Kuala Lumpur">Kuala Lumpur</option>
                                <option value="Labuan">Labuan</option>
                                <option value="Putrajaya">Putrajaya</option>
                            </select>
                        </div>
                    </div>
                    <button id="lookupBtn" class="lookup-btn">Look Up Property</button>
                </div>
                
                <div id="propertyResults" class="property-results" style="display: none;">
                    <div class="dashboard-grid">
                        <!-- Key Metrics Card -->
                        <div class="dashboard-card metrics-card">
                            <div class="metric-group">
                                <div class="metric primary">
                                    <span class="metric-value">${formatCurrency(data.propertyData.estimatedValue)}</span>
                                    <span class="metric-label">Property Value</span>
                                    <div class="metric-trend">+12% vs Market Avg</div>
                                </div>
                                <div class="stats-row">
                                    <div class="stat">
                                        <span class="stat-label">Annual Rental Income</span>
                                        <span class="stat-value">${formatCurrency(Math.round(data.propertyData.estimatedValue * 0.08))}</span>
                                    </div>
                                    <div class="stat">
                                        <span class="stat-label">Cap Rate</span>
                                        <span class="stat-value">8%</span>
                                    </div>
                                    <div class="stat">
                                        <span class="stat-label">5-Year ROI</span>
                                        <span class="stat-value">47%</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Property Details -->
                        <div class="dashboard-card details-card">
                            <div class="property-header">
                                <div class="property-type">
                                    <i class="fas fa-home"></i>
                                    <span>${data.propertyData.propertyType}</span>
                                </div>
                                <div class="property-specs">
                                    <span><i class="fas fa-bed"></i> ${data.propertyData.bedrooms}</span>
                                    <span><i class="fas fa-bath"></i> ${data.propertyData.bathrooms}</span>
                                    <span><i class="fas fa-ruler-combined"></i> ${data.propertyData.squareFootage.toLocaleString()} sqft</span>
                                </div>
                            </div>
                            <div class="property-features">
                                <div class="feature">
                                    <span class="feature-label">Year Built</span>
                                    <span class="feature-value">${data.propertyData.yearBuilt}</span>
                                </div>
                                <div class="feature">
                                    <span class="feature-label">Lot Size</span>
                                    <span class="feature-value">${data.propertyData.lotSize}</span>
                                </div>
                                <div class="feature">
                                    <span class="feature-label">Price per Sq Ft</span>
                                    <span class="feature-value">${formatCurrency(Math.round(data.propertyData.estimatedValue / data.propertyData.squareFootage))}</span>
                                </div>
                            </div>
                        </div>

                        <!-- Action Button -->
                        <a href="/wallet.html" class="tokenize-btn" onclick="localStorage.setItem('propertyValue', '${data.propertyData.estimatedValue}')">
                            Start Tokenization Process
                        </a>
                    </div>
                </div>
                
                <div id="loadingIndicator" class="loading-indicator" style="display: none;">
                    <div class="spinner"></div>
                    <p>Fetching property data...</p>
                </div>
            </div>
        </div>
    </section>

    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-brand">
                    <div class="footer-logo">
                        <img src="images/logo.png" alt="Trick Logo">
                        <span>Trick</span>
                    </div>
                    <p>Revolutionizing real estate through blockchain technology and property tokenization. Making property ownership accessible, transparent, and community-driven.</p>
                </div>

                <div class="footer-links">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href="index.html#problem" class="nav-link">The Problem</a></li>
                        <li><a href="index.html#tokenization" class="nav-link">How It Works</a></li>
                        <li><a href="index.html#solution" class="nav-link">Our Solution</a></li>
                        <li><a href="index.html#benefits" class="nav-link">Benefits</a></li>
                        <li><a href="marketplace.html" class="nav-link">Properties</a></li>
                        <li><a href="wallet.html" class="nav-link">Wallet</a></li>
                        <li><a href="index.html#contact">Contact Us</a></li>
                    </ul>
                </div>

                <div class="footer-contact">
                    <h4>Contact Us</h4>
                    <p>Email: info@trick.com</p>
                    <p>Support: 24/7 Available</p>
                    <p>Location: Kuala Lumpur, Malaysia</p>
                </div>
            </div>

            <div class="footer-bottom">
                <p>© 2024 Trick. All rights reserved.</p>
                <p class="disclaimer">Operating under applicable securities regulations.</p>
            </div>
        </div>
    </footer>

    <script>
    function formatCurrency(value) {
        return new Intl.NumberFormat('ms-MY', {
            style: 'currency',
            currency: 'MYR',
            maximumFractionDigits: 0
        }).format(value);
    }

    function checkImageExists(url) {
        const img = new Image();
        img.src = url;
        img.onload = () => console.log('Image exists:', url);
        img.onerror = () => console.error('Image does not exist:', url);
    }

    document.addEventListener('DOMContentLoaded', () => {
        const propertySearch = document.getElementById('propertySearch');
        const propertyType = document.getElementById('propertyType');
        const priceRange = document.getElementById('priceRange');
        const tokenization = document.getElementById('tokenization');

        // Search functionality
        propertySearch.addEventListener('input', filterProperties);
        propertyType.addEventListener('change', filterProperties);
        priceRange.addEventListener('change', filterProperties);
        tokenization.addEventListener('change', filterProperties);

        function filterProperties() {
            // Add your filtering logic here
            console.log('Filtering properties...');
        }

        // Simple Previous/Next pagination
        const prevButton = document.querySelector('.page-btn.prev');
        const nextButton = document.querySelector('.page-btn.next');
        
        prevButton.addEventListener('click', () => {
            console.log('Loading previous page...');
            // Add your previous page logic here
        });
        
        nextButton.addEventListener('click', () => {
            console.log('Loading next page...');
            // Add your next page logic here
        });

        const propertyGrid = document.querySelector('.property-grid');
        
        // Test each image path
        houseImages.forEach(image => {
            checkImageExists(`/images/house_pictures/${image}`);
            checkImageExists(`./images/house_pictures/${image}`);
        });
    });
    </script>

    <script>
    // Property data generation
    document.addEventListener('DOMContentLoaded', () => {
        const propertyGrid = document.querySelector('.property-grid');
        let currentPage = 1;
        const propertiesPerPage = 8;
        let allProperties = [];
        let filteredProperties = [];
        let lastUsedImageIndex = -1;  // Track the last used image index
        
        // Sample data arrays for realistic property generation
        const propertyNames = [
            "LaCosta @ Sunway South Quay",
            "LaCosta @ Sunway South Quay",
            "Sunway GeoLake Residences",
            "Sunway Geo Residence",
            "Ridzuan Condominium",
            "Greenfield Residence",
            "Taman Sri Subang, Sunway"
        ];

        const houseImages = [
            'pexels-binyaminmellish-106399.jpg',
            'pexels-binyaminmellish-1396132.jpg',
            'pexels-expect-best-79873-323780.jpg',
            'pexels-luis-yanez-57302-206172.jpg',
            'pexels-pixabay-210617.jpg',
            'pexels-pixabay-259588.jpg',
            'pexels-pixabay-259593.jpg',
            'pexels-pixabay-277667.jpg',
            'pexels-pixasquare-1115804.jpg',
            'pexels-scottwebb-1029599.jpg',
            'pexels-fotios-photos-2816323.jpg',
            'pexels-tara-winstead-8407011.jpg',
            'pexels-perqued-13041118.jpg',
            'pexels-heyho-7598376.jpg',
            'pexels-b-s-gulesan-2144469394-30847025.jpg',
            'pexels-szafran-30866045.jpg',
            'pexels-lina-3639542.jpg',
            'pexels-julia-kuzenkov-442028-1974596.jpg'
        ];

        const amenities = [
            "Private Pool",
            "Ocean View",
            "Smart Home",
            "Wine Cellar",
            "Home Theater",
            "Rooftop Deck",
            "Tennis Court",
            "Spa",
            "Guest House",
            "Elevator"
        ];

        function generateRandomProperty(index) {
            const propertyName = propertyNames[index % propertyNames.length];
            const tokenizationProgress = Math.floor(Math.random() * 100);
            const propertyValueMillions = +(0.8 + Math.random() * 6.2).toFixed(1);
            const propertyValue = Math.round(propertyValueMillions * 1000000);
            const tokenPrice = Math.floor(propertyValue / 10000);
            const beds = Math.floor(3 + Math.random() * 7);
            const baths = Math.floor(beds * 0.7);
            const sqft = Math.floor(2000 + Math.random() * 8000);
            // Get a random image that's different from the last one
            let newImageIndex;
            do {
                newImageIndex = Math.floor(Math.random() * houseImages.length);
            } while (newImageIndex === lastUsedImageIndex);
            
            lastUsedImageIndex = newImageIndex;
            const image = houseImages[newImageIndex];

            return {
                name: propertyName,
                category: 'residential',
                location: `Bandar Sunway, Selangor`,
                beds,
                baths,
                sqft,
                tokenization: tokenizationProgress,
                tokenPrice,
                propertyValue,
                image: image,
                status: tokenizationProgress < 100 ? 'Available' : 'Fully Tokenized'
            };
        }

        // Generate all properties once
        for (let i = 0; i < 24; i++) {
            allProperties.push(generateRandomProperty(i));
        }
        filteredProperties = [...allProperties];

        function displayProperties(page) {
            const startIndex = (page - 1) * propertiesPerPage;
            const endIndex = startIndex + propertiesPerPage;
            const propertiesToShow = filteredProperties.slice(startIndex, endIndex);
            
            propertyGrid.innerHTML = ''; // Clear existing properties

            propertiesToShow.forEach(property => {
                const propertyCard = `
                    <div class="property-card">
                        <div class="property-image">
                            <img src="./images/house_pictures/${property.image}"
                                 alt="${property.name}"
                                 onload="console.log('Image loaded successfully:', this.src)"
                                 onerror="console.error('Failed to load image:', this.src, 'Error:', event);">
                            <div class="property-status ${property.status === 'Available' ? 'available' : 'tokenized'}">${property.status}</div>
                        </div>
                        <div class="property-details">
                            <h3>${property.name}</h3>
                            <p class="location">${property.location}</p>
                            <div class="property-stats">
                                <span>${property.beds} Beds</span>
                                <span>${property.baths} Baths</span>
                                <span>${property.sqft.toLocaleString()} sqft</span>
                            </div>
                            <div class="tokenization-info">
                                <div class="progress-bar">
                                    <div class="progress" style="width: ${property.tokenization}%"></div>
                                </div>
                                <p>${property.tokenization}% Tokenized</p>
                            </div>
                            <div class="price-info">
                                <div class="token-price">
                                    <span>Token Price</span>
                                    <strong>${formatCurrency(property.tokenPrice)}</strong>
                                </div>
                                <div class="property-value">
                                    <span>Property Value</span>
                                    <strong>${formatCurrency(property.propertyValue)}</strong>
                                </div>
                            </div>
                            <a href="/wallet.html" class="invest-btn">Invest Now</a>
                        </div>
                    </div>
                `;
                propertyGrid.innerHTML += propertyCard;
            });

            // Update pagination buttons state
            const prevButton = document.querySelector('.page-btn.prev');
            const nextButton = document.querySelector('.page-btn.next');
            
            prevButton.disabled = currentPage === 1;
            nextButton.disabled = currentPage >= Math.ceil(filteredProperties.length / propertiesPerPage);
            
            prevButton.style.opacity = prevButton.disabled ? '0.5' : '1';
            nextButton.style.opacity = nextButton.disabled ? '0.5' : '1';
        }

        // Initialize first page
        displayProperties(currentPage);

        // Update pagination event listeners
        const prevButton = document.querySelector('.page-btn.prev');
        const nextButton = document.querySelector('.page-btn.next');
        
        prevButton.addEventListener('click', () => {
            if (currentPage > 1) {
                currentPage--;
                displayProperties(currentPage);
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        });
        
        nextButton.addEventListener('click', () => {
            if (currentPage < Math.ceil(filteredProperties.length / propertiesPerPage)) {
                currentPage++;
                displayProperties(currentPage);
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        });

        function filterProperties() {
            const searchTerm = propertySearch.value.toLowerCase();
            const selectedType = propertyType.value;
            const selectedPriceRange = priceRange.value;
            const selectedTokenization = tokenization.value;

            filteredProperties = allProperties.filter(property => {
                // Search term filter
                const matchesSearch =
                    property.name.toLowerCase().includes(searchTerm) ||
                    property.location.toLowerCase().includes(searchTerm) ||
                    property.propertyValue.toLocaleString().includes(searchTerm);

                // Property type filter
                const matchesType = !selectedType || property.category === selectedType;

                // Price range filter
                let matchesPrice = true;
                if (selectedPriceRange) {
                    const propertyPrice = property.propertyValue;
                    const [minPrice, maxPrice] = selectedPriceRange.split('-').map(Number);
                    matchesPrice = propertyPrice >= minPrice && propertyPrice <= maxPrice;
                }

                // Tokenization status filter
                let matchesTokenization = true;
                if (selectedTokenization) {
                    switch(selectedTokenization) {
                        case 'available':
                            matchesTokenization = property.tokenization < 100;
                            break;
                        case 'in-progress':
                            matchesTokenization = property.tokenization > 0 && property.tokenization < 100;
                            break;
                        case 'completed':
                            matchesTokenization = property.tokenization === 100;
                            break;
                    }
                }

                return matchesSearch && matchesType && matchesPrice && matchesTokenization;
            });

            // Reset to first page when filtering
            currentPage = 1;
            displayProperties(currentPage);

            // Update UI to show number of results
            const resultsCount = document.createElement('p');
            resultsCount.className = 'results-count';
            resultsCount.textContent = `${filteredProperties.length} properties found`;
            const existingCount = document.querySelector('.results-count');
            if (existingCount) {
                existingCount.remove();
            }
            document.querySelector('.property-grid').insertAdjacentElement('beforebegin', resultsCount);
        }

        // Add debounce for search input
        let searchTimeout;
        propertySearch.addEventListener('input', () => {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(filterProperties, 300);
        });

        // Immediate filter for select inputs
        propertyType.addEventListener('change', filterProperties);
        priceRange.addEventListener('change', filterProperties);
        tokenization.addEventListener('change', filterProperties);
    });
    </script>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const toggleBtns = document.querySelectorAll('.toggle-btn');
        const views = document.querySelectorAll('.view-content');
        
        toggleBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                // Update button states
                toggleBtns.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                
                // Show selected view
                const viewToShow = btn.dataset.view;
                views.forEach(view => {
                    view.style.display = view.id === `${viewToShow}-view` ? 'block' : 'none';
                });
            });
        });
    });
    </script>

    <script>
    // Add property lookup functionality
    document.addEventListener('DOMContentLoaded', () => {
        const lookupForm = document.querySelector('.lookup-form');
        const lookupBtn = document.getElementById('lookupBtn');
        const propertyResults = document.getElementById('propertyResults');
        const loadingIndicator = document.getElementById('loadingIndicator');

        if (!lookupBtn || !propertyResults || !loadingIndicator) {
            console.error('Required elements not found');
            return;
        }

        lookupBtn.addEventListener('click', async (e) => {
            e.preventDefault();
            
            const address = document.getElementById('address').value;
            const city = document.getElementById('city').value;
            const state = document.getElementById('state').value;

            if (!address || !city || !state) {
                alert('Please fill in all fields');
                return;
            }

            // Show loading indicator
            loadingIndicator.style.display = 'flex';
            propertyResults.style.display = 'none';

            try {
                const response = await fetch('/.netlify/functions/property-lookup', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ address, city, state })
                });

                const data = await response.json();

                // Hide loading indicator
                loadingIndicator.style.display = 'none';
                
                if (data.error) {
                    propertyResults.innerHTML = `
                        <div class="error-message">
                            <h3>Error</h3>
                            <p>${data.error}</p>
                        </div>
                    `;
                } else {
                    // Display property results
                    propertyResults.innerHTML = createDashboardHTML(data);
                }
                propertyResults.style.display = 'block';
            } catch (error) {
                loadingIndicator.style.display = 'none';
                propertyResults.innerHTML = `
                    <div class="error-message">
                        <h3>Error</h3>
                        <p>Failed to fetch property data. Please try again later.</p>
                    </div>
                `;
                propertyResults.style.display = 'block';
            }
        });
    });

    function createDashboardHTML(data) {
        const html = `
            <div class="dashboard-grid">
                <!-- Key Metrics Card -->
                <div class="dashboard-card metrics-card">
                    <div class="metric-group">
                        <div class="metric primary">
                            <span class="metric-value">${formatCurrency(data.propertyData.estimatedValue)}</span>
                            <span class="metric-label">Property Value</span>
                            <div class="metric-trend">+12% vs Market Avg</div>
                        </div>
                        <div class="stats-row">
                            <div class="stat">
                                <span class="stat-label">Annual Rental Income</span>
                                <span class="stat-value">${formatCurrency(Math.round(data.propertyData.estimatedValue * 0.08))}</span>
                            </div>
                            <div class="stat">
                                <span class="stat-label">Cap Rate</span>
                                <span class="stat-value">8%</span>
                            </div>
                            <div class="stat">
                                <span class="stat-label">5-Year ROI</span>
                                <span class="stat-value">47%</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Property Details -->
                <div class="dashboard-card details-card">
                    <div class="property-header">
                        <div class="property-type">
                            <i class="fas fa-home"></i>
                            <span>${data.propertyData.propertyType}</span>
                        </div>
                        <div class="property-specs">
                            <span><i class="fas fa-bed"></i> ${data.propertyData.bedrooms}</span>
                            <span><i class="fas fa-bath"></i> ${data.propertyData.bathrooms}</span>
                            <span><i class="fas fa-ruler-combined"></i> ${data.propertyData.squareFootage.toLocaleString()} sqft</span>
                        </div>
                    </div>
                    <div class="property-features">
                        <div class="feature">
                            <span class="feature-label">Year Built</span>
                            <span class="feature-value">${data.propertyData.yearBuilt}</span>
                        </div>
                        <div class="feature">
                            <span class="feature-label">Lot Size</span>
                            <span class="feature-value">${data.propertyData.lotSize}</span>
                        </div>
                        <div class="feature">
                            <span class="feature-label">Price per Sq Ft</span>
                            <span class="feature-value">${formatCurrency(Math.round(data.propertyData.estimatedValue / data.propertyData.squareFootage))}</span>
                        </div>
                    </div>
                </div>

                <!-- Action Button -->
                <a href="/wallet.html" class="tokenize-btn" onclick="localStorage.setItem('propertyValue', '${data.propertyData.estimatedValue}')">
                    Start Tokenization Process
                </a>
            </div>
        `;
        
        return html;
    }
    </script>

    <script>
    function showPropertyLookup(event) {
        event.preventDefault();
        const marketplaceView = document.querySelector('.marketplace-view');
        const lookupView = document.querySelector('.lookup-view');
        const pageTitle = document.querySelector('.marketplace-title');
        
        if (marketplaceView) marketplaceView.style.display = 'none';
        if (lookupView) lookupView.style.display = 'block';
        if (pageTitle) pageTitle.textContent = 'Property Lookup';
    }

    function showMarketplace() {
        const marketplaceView = document.querySelector('.marketplace-view');
        const lookupView = document.querySelector('.lookup-view');
        const pageTitle = document.querySelector('.marketplace-title');
        
        if (marketplaceView) marketplaceView.style.display = 'block';
        if (lookupView) lookupView.style.display = 'none';
        if (pageTitle) pageTitle.textContent = 'Property Marketplace';
    }

    // Show marketplace view by default
    document.addEventListener('DOMContentLoaded', () => {
        showMarketplace();
        
        // Add event listener for lookup button
        const lookupBtn = document.getElementById('lookupBtn');
        if (lookupBtn) {
            lookupBtn.addEventListener('click', async (e) => {
                e.preventDefault();
                const results = document.getElementById('propertyResults');
                if (!results) return;

                results.style.display = 'block';
                results.innerHTML = `
                    <div class="loading-indicator">
                        <div class="spinner"></div>
                    </div>
                `;

                try {
                    const response = await fetch('/.netlify/functions/property-lookup', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            address: document.getElementById('address')?.value || '',
                            city: document.getElementById('city')?.value || '',
                            state: document.getElementById('state')?.value || ''
                        })
                    });

                    if (!response.ok) throw new Error('Failed to fetch property data');
                    const data = await response.json();
                    
                    results.innerHTML = createDashboardHTML(data);
                } catch (error) {
                    results.innerHTML = `
                        <div class="error-message">
                            <p>Sorry, we couldn't find the property details.</p>
                            <p class="error-details">${error.message}</p>
                        </div>
                    `;
                }
            });
        }
    });
    </script>
</body>
</html> 